<project default="antunit" xmlns:au="antlib:org.apache.ant.antunit">
  <import file="../antunit-base.xml" />

  <target name="tearDown">
    <delete file="binaryAppendDest" />
    <delete file="encodeStringDest" />
  </target>

  <target name="testBinaryAppend">
    <au:assertTrue message="prerequisite conditions unmet">
      <length length="0">
        <!-- allow for nonexistent OR zero-length: -->
        <fileset file="binaryAppendDest" />
      </length>
    </au:assertTrue>
    <echo file="binaryAppendDest">x</echo>
    <au:assertTrue message="destfile setup failed">
      <length length="1" file="binaryAppendDest" />
    </au:assertTrue>
    <concat append="true" destfile="binaryAppendDest" binary="true">
      <string value="x" />
    </concat>
    <au:assertTrue message="expected length 2">
      <length file="binaryAppendDest" length="2" />
    </au:assertTrue>
  </target>

  <target name="testStringEncoding" if="os.unix">
    <property name="br" value="${line.separator}" />
    <concat destfile="encodeStringDest"
            outputEncoding="utf-16">foo${br}bar${br}baz${br}</concat>
    <au:assertTrue>
      <resourcesmatch astext="true">
        <file file="utf-16.expected" />
        <file file="encodeStringDest" />
      </resourcesmatch>
    </au:assertTrue>
  </target>
	
  <target name="testStringEncodingWindows" if="os.windows">
    <property name="br" value="${line.separator}" />
	<concat destfile="encodeStringDest"
	        outputEncoding="utf-16">foo${br}bar${br}baz${br}</concat>
	<au:assertTrue>
	  <resourcesmatch astext="true">
	    <file file="utf-16.expected.windows" />
	    <file file="encodeStringDest" />
	  </resourcesmatch>
	</au:assertTrue>
  </target>

  <target name="testDoNotFixNestedText" description="Bugzilla 42369">
    <au:assertTrue>
      <resourcesmatch>
        <string>foo</string>
        <concat fixlastline="true">foo</concat>
      </resourcesmatch>
    </au:assertTrue>
  </target>

</project>
