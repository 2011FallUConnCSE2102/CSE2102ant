<?xml version="1.0" ?>
<project name="XDoclet" default="default">

  <property name="log4j.jar" location="../../lib/optional/log4j.jar"/>
  <property name="xdoclet.jar" location="lib/xdoclet.jar"/>

  <property name="src.dir"
            location="../../src/main/org/apache/tools/ant/taskdefs"/>
  <property name="src.root"
            location="../../src/main"/>
  <property name="build.dir" location="build"/>
  <property name="gen.dir" location="${build.dir}/gen"/>

  <property name="template.dir" location="templates"/>
  <property name="defaults.properties.template"
            location="${template.dir}/defaults_properties.template"/>
  <property name="xdoc.template"
            location="${template.dir}/task_xdoc.template"/>


  <target name="init">
    <mkdir dir="${build.dir}" />
    <mkdir dir="${gen.dir}" />

    <!-- hack, this should be outside a target but ${build.dir} gets stripped ?? -->
    <path id="xdoclet.classpath">
      <pathelement location="${log4j.jar}"/>
      <pathelement location="${xdoclet.jar}"/>

      <!-- javadoc is needed -->
      <pathelement path="${java.class.path}"/>
      <pathelement location="${build.dir}"/>
    </path>
  </target>


  <target name="clean">
    <delete dir="${build.dir}"/>
  </target>

  <target name="compile" depends="init">
    <javac srcdir="src" destdir="${build.dir}"
           debug="true" classpathref="xdoclet.classpath"/>
  </target>

  <target name="gen" depends="compile">
    <delete dir="${gen.dir}"/>

    <taskdef name="document"
             classname="xdoclet.doc.DocumentDocletTask"
             classpathref="xdoclet.classpath"/>

    <document sourcepath="${src.root}"
              destdir="${gen.dir}"
              classpathref="xdoclet.classpath">
      <fileset dir="${src.dir}">
        <include name="**/*.java" unless="class.name"/>
        <include name="**/${class.name}.java" if="class.name"/>
      </fileset>
      <template subTaskClassName="org.apache.tools.ant.xdoclet.AntSubTask"
                templateFile="${defaults.properties.template}"
                destinationfile="defaults.properties"/>
      <template subTaskClassName="org.apache.tools.ant.xdoclet.AntSubTask"
                templateFile="${xdoc.template}"
                destinationfile="{0}.xml" extent="concrete-type"/>
    </document>

    <!-- currently not working - bug in XDoclet?
    <document sourcepath="src"
              destdir="${gen.dir}"
              classpathref="xdoclet.classpath">
      <fileset dir="src">
        <include name="**/*.java"/>
      </fileset>
      <documenttags/>
    </document> -->

  </target>

  <target name="docs" depends="gen">
    <ant dir="dvsl"/>
  </target>

  <target name="default" depends="gen"/>
</project>

